import{B,C as Q,r as C,A as D,o as L,E as H,G as U,H as m,I as c,f as r,K as z,J as o,L as y}from"./index.b0846524.js";import{a as w,Q as A}from"./QCard.783d5ef5.js";import{c as q,Q as d}from"./QForm.e008005b.js";import{Q as K}from"./QPage.22761661.js";import{u as N,f as S,e as I,a as $,b as F}from"./index.17631ce7.js";import{u as T}from"./store.ee215695.js";import{u as j}from"./vue-i18n.runtime.esm-bundler.3cfb172c.js";import{F as g,i as p,a as P}from"./shared.11b2290b.js";import"./use-dark.2c6a9be7.js";import"./axios.7331a07d.js";const G={class:"row"},J={class:"row justify-between items-center"},M={class:"text-h6 text-weight-bold"},O={class:"row"},re=B({__name:"AddPersonPage",props:{isDesktop:{type:Boolean}},setup(W){const u=N(),f=Q(),b=T(),{t:a}=j(),h=new RegExp(/^[А-Я][а-я]+(-[А-Я][а-я]+)*$/),V=new RegExp(/^[А-Я][а-я]+$/),x=new RegExp(/^[А-Яа-я0-9.,:\- ]+$/),l=C(!1),t=D({phone:"",lastname:"",firstname:"",surname:"",vk:"",address:"",comment:"",createdAt:0}),k=async()=>{if(p(t.phone)&&await E(t.phone)){u.notify({type:"info",message:a("addPersonPage.form.alreadyExistsPhone"),actions:[{icon:"close",color:"white",round:!0}]});return}if(P(t.vk)&&await _(t.vk)){u.notify({type:"info",message:a("addPersonPage.form.alreadyExistsVK"),actions:[{icon:"close",color:"white",round:!0}]});return}const n={...t};delete n.comment,n.createdAt=new Date().getTime();try{l.value=!0;const s=await S(n);b.foundPersonData=s,await I({personId:s.id,text:t.comment,createdAt:new Date().getTime()}),await b.getCurrentCountOfPersons(),u.notify({type:"positive",message:a("addPersonPage.form.success"),actions:[{icon:"close",color:"white",round:!0}]}),f.push("/results")}catch{u.notify({type:"negative",message:a("addPersonPage.form.failed"),actions:[{icon:"close",color:"white",round:!0}]})}finally{l.value=!1}},E=async n=>{var s,e;try{return await $(n),!0}catch(i){if(((e=(s=i.response)==null?void 0:s.status)!=null?e:0)===404)return!1;throw u.notify({type:"negative",message:a("addPersonPage.form.checkExistingError"),actions:[{icon:"close",color:"white",round:!0}]}),new Error}},_=async n=>{var s,e;try{return await F(n),!0}catch(i){if(((e=(s=i.response)==null?void 0:s.status)!=null?e:0)===404)return!1;throw u.notify({type:"negative",message:a("addPersonPage.form.checkExistingError"),actions:[{icon:"close",color:"white",round:!0}]}),new Error}};return L(()=>{const{field:n,value:s}=f.currentRoute.value.query;if(!!(n!=null&&n.length)&&!!(s!=null&&s.length))switch(n){case g.Phone:t.phone=s;break;case g.VK:t.vk=s;break;case g.Name:const[e,i]=s.trim().split(" ");t.lastname=e,t.firstname=i;break;default:throw new Error(a("addPersonPage.error"))}}),(n,s)=>(H(),U(K,null,{default:m(()=>[c("div",G,[r(A,{flat:"",class:"q-mt-md col-12 col-md-4 offset-md-4"},{default:m(()=>[r(w,null,{default:m(()=>[c("div",J,[c("div",M,z(o(a)("addPersonPage.title")),1),r(y,{outline:"",icon:"chevron_left","no-caps":"",label:n.isDesktop?o(a)("shared.toSearchBtn"):"",round:!n.isDesktop,color:"secondary",onClick:s[0]||(s[0]=()=>o(f).push("/"))},null,8,["label","round"])])]),_:1}),r(w,null,{default:m(()=>[r(q,{class:"q-gutter-md q-mb-md",onSubmit:k},{default:m(()=>[r(d,{outlined:"",label:o(a)("addPersonPage.form.phoneLabel"),mask:"+7 (###) ###-##-##",placeholder:"+7 (___) ___-__-__",modelValue:t.phone,"onUpdate:modelValue":s[1]||(s[1]=e=>t.phone=e),"lazy-rules":"",disable:l.value,rules:[e=>!!(e!=null&&e.length)&&o(p)(e)||o(P)(t.vk)&&!(e!=null&&e.length)||o(a)("addPersonPage.form.phoneHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",label:o(a)("addPersonPage.form.lastnameLabel"),modelValue:t.lastname,"onUpdate:modelValue":s[2]||(s[2]=e=>t.lastname=e),maxlength:50,"lazy-rules":"",disable:l.value,rules:[e=>o(h).test(e)||!(e!=null&&e.length)||o(a)("addPersonPage.form.nameHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",label:o(a)("addPersonPage.form.firstnameLabel"),modelValue:t.firstname,"onUpdate:modelValue":s[3]||(s[3]=e=>t.firstname=e),maxlength:50,"lazy-rules":"",disable:l.value,rules:[e=>o(h).test(e)||!(e!=null&&e.length)||o(a)("addPersonPage.form.nameHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",label:o(a)("addPersonPage.form.surnameLabel"),modelValue:t.surname,"onUpdate:modelValue":s[4]||(s[4]=e=>t.surname=e),maxlength:50,"lazy-rules":"",disable:l.value,rules:[e=>o(V).test(e)||!(e!=null&&e.length)||o(a)("addPersonPage.form.nameHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",label:o(a)("addPersonPage.form.vkLabel"),placeholder:"https://vk.com/...",modelValue:t.vk,"onUpdate:modelValue":s[5]||(s[5]=e=>t.vk=e),maxlength:47,"lazy-rules":"",disable:l.value,rules:[e=>!!(e!=null&&e.length)&&o(P)(e)||o(p)(t.phone)&&!(e!=null&&e.length)||o(a)("addPersonPage.form.vkHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",label:o(a)("addPersonPage.form.addressLabel"),modelValue:t.address,"onUpdate:modelValue":s[6]||(s[6]=e=>t.address=e),maxlength:150,disable:l.value,"lazy-rules":"",rules:[e=>o(x).test(e)||!(e!=null&&e.length)||o(a)("addPersonPage.form.addressHint")]},null,8,["label","modelValue","disable","rules"]),r(d,{outlined:"",modelValue:t.comment,"onUpdate:modelValue":s[7]||(s[7]=e=>t.comment=e),maxlength:1024,type:"textarea",label:o(a)("shared.commentLabel"),"lazy-rules":"",disable:l.value,rules:[e=>e&&e.length>0||o(a)("shared.commentHint")]},null,8,["modelValue","label","disable","rules"]),c("div",O,[r(y,{type:"submit",label:o(a)("addPersonPage.form.submitBtn"),"no-caps":"",unelevated:"",color:"primary",loading:l.value,class:"col-12 col-md-4 offset-md-8"},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{re as default};
